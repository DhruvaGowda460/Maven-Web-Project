pipeline{
	agent{
	label ('slave_Tomcat')
	}
	triggers{
		//githubPush()
		//cron('* * * * *')
		//pollSCM('* * * * *')

	}//triggers closed
	tools{
		maven "maven3.8.1"
	}//tools closed
	
	options{
		timestamps()
		buildDiscarder(logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '5', daysToKeepStr: '', numToKeepStr: '5'))
	
	}//options closed

stages{
	
	stage('CheckOutCode'){
	steps{
	git branch: 'development', credentialsId: '9dd19eff-aa52-4a04-a57d-dfaa51373d57', url: 'https://github.com/COVID-19-AP/maven-web-application.git'
	}
	}//checkoutOut closed
    stage('Build'){
	  steps{
	     sh "mvn clean package"
		 }
   }//Build stage closed
    stage('ExeciteSonarQubeReport'){
	    steps{
	     sh "mvn clean sonar:sonar"
		 }
   }//ExecuteSonarQubeReport stage closed
	stage('UploadArtifactIntonexus'){
		steps{
			sh "mvn deploy"
		}
	}//UploadArtifactIntonexus stage close
	
	stage('DeployIntoTomcatServer'){
		steps{
			sshagent(['33bc9cd9-4fc8-4a32-a365-3d55101b2cf3']) {
			sh "scp -o StrictHostKeyChecking=no target/maven-web-application.war ec2-user@35.154.171.239:/opt/apache-tomcat-9.0.46/webapps"
			}
		}
	}//DeployIntoTomcatServer stage closed
	

}//stagres closed

post{
success{
	emailext body: '''Hi Team,

 You build is scuess.

Best regards
Purushotham A
9494412397''', subject: 'Build is Success !!!', to: 'apurushotham19@gmail.com'
}
	failure{
		emailext body: '''Hi Team,

Your build is failure 

Besr regards
Purushotham A 
9494412397''', subject: 'Build is failure !!!', to: 'apurushotham19@gmail.com'
	}

}//post section closed

}//pipeline close
